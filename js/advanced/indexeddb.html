<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IndexedDB | 江北</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/blog/imgs/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="为中华民族之崛起而努力">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/blog/assets/css/0.styles.d0858680.css" as="style"><link rel="preload" href="/blog/assets/js/app.71c01b6c.js" as="script"><link rel="preload" href="/blog/assets/js/2.c0191e23.js" as="script"><link rel="preload" href="/blog/assets/js/10.769c860c.js" as="script"><link rel="preload" href="/blog/assets/js/3.d0de4903.js" as="script"><link rel="prefetch" href="/blog/assets/js/11.cd7e6c2a.js"><link rel="prefetch" href="/blog/assets/js/12.f749abcc.js"><link rel="prefetch" href="/blog/assets/js/13.c253f91b.js"><link rel="prefetch" href="/blog/assets/js/14.79b103e2.js"><link rel="prefetch" href="/blog/assets/js/15.ee52efe2.js"><link rel="prefetch" href="/blog/assets/js/16.072b1975.js"><link rel="prefetch" href="/blog/assets/js/17.3abdce12.js"><link rel="prefetch" href="/blog/assets/js/18.fa0a5edd.js"><link rel="prefetch" href="/blog/assets/js/19.aa388fcf.js"><link rel="prefetch" href="/blog/assets/js/20.8f02659c.js"><link rel="prefetch" href="/blog/assets/js/21.04293f5c.js"><link rel="prefetch" href="/blog/assets/js/22.bfa07d9c.js"><link rel="prefetch" href="/blog/assets/js/23.f1dbad04.js"><link rel="prefetch" href="/blog/assets/js/24.73dc77c1.js"><link rel="prefetch" href="/blog/assets/js/25.fcbe3b22.js"><link rel="prefetch" href="/blog/assets/js/26.7ab6cc65.js"><link rel="prefetch" href="/blog/assets/js/27.10aeb5e9.js"><link rel="prefetch" href="/blog/assets/js/28.51925612.js"><link rel="prefetch" href="/blog/assets/js/29.d20fc77f.js"><link rel="prefetch" href="/blog/assets/js/30.b754a29e.js"><link rel="prefetch" href="/blog/assets/js/31.a00248a5.js"><link rel="prefetch" href="/blog/assets/js/32.154f3b00.js"><link rel="prefetch" href="/blog/assets/js/33.243d641d.js"><link rel="prefetch" href="/blog/assets/js/4.858f4870.js"><link rel="prefetch" href="/blog/assets/js/5.23f973fb.js"><link rel="prefetch" href="/blog/assets/js/6.a37f274f.js"><link rel="prefetch" href="/blog/assets/js/7.f00de9bb.js"><link rel="prefetch" href="/blog/assets/js/8.88b80aa7.js"><link rel="prefetch" href="/blog/assets/js/9.a18ffa96.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.d0858680.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">江北</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/js/basic/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue List" class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue2/" class="nav-link">
  vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/vue3/" class="nav-link">
  vue3.x
</a></li></ul></div></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Js List" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/questions/js/" class="nav-link">
  原生js
</a></li><li class="dropdown-item"><!----> <a href="/blog/questions/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">算法篇</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/leetcode/array/" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/string/" class="nav-link">
  字符串
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/list/" class="nav-link">
  链表
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/tree/" class="nav-link">
  树
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/other/" class="nav-link">
  其它
</a></li></ul></div></div><div class="nav-item"><a href="https://jiangbei.online" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/atjiangbei/blog/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/js/advanced/indexeddb.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/blog/en.html" class="nav-link">
  en-US
</a></li></ul></div></div> <a href="https://github.com/atJiangBei/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/js/basic/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue List" class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue2/" class="nav-link">
  vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/vue3/" class="nav-link">
  vue3.x
</a></li></ul></div></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Js List" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/questions/js/" class="nav-link">
  原生js
</a></li><li class="dropdown-item"><!----> <a href="/blog/questions/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">算法篇</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/leetcode/array/" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/string/" class="nav-link">
  字符串
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/list/" class="nav-link">
  链表
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/tree/" class="nav-link">
  树
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/other/" class="nav-link">
  其它
</a></li></ul></div></div><div class="nav-item"><a href="https://jiangbei.online" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/atjiangbei/blog/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/js/advanced/indexeddb.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/blog/en.html" class="nav-link">
  en-US
</a></li></ul></div></div> <a href="https://github.com/atJiangBei/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/blog/message.html" class="sidebar-link">序言</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js/basic/" class="sidebar-link">typeof和instanceof</a></li><li><a href="/blog/js/basic/jicheng.html" class="sidebar-link">js的继承</a></li><li><a href="/blog/js/basic/prototypeandproto.html" class="sidebar-link">原型和原型链</a></li><li><a href="/blog/js/basic/meta.html" class="sidebar-link">meta</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js/advanced/currying.html" class="sidebar-link">柯里化</a></li><li><a href="/blog/js/advanced/eventloop.html" class="sidebar-link">事件循环</a></li><li><a href="/blog/js/advanced/indexeddb.html" aria-current="page" class="active sidebar-link">IndexedDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/js/advanced/indexeddb.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/blog/js/advanced/indexeddb.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/blog/js/advanced/indexeddb.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/blog/js/advanced/indexeddb.html#本文具体实用的价值" class="sidebar-link">本文具体实用的价值</a></li></ul></li><li><a href="/blog/js/advanced/webworkers.html" class="sidebar-link">WebWorker</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>手写篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js/write/array.html" class="sidebar-link">数组</a></li><li><a href="/blog/js/write/object.html" class="sidebar-link">对象</a></li><li><a href="/blog/js/write/function.html" class="sidebar-link">函数</a></li><li><a href="/blog/js/write/eventEmitter.html" class="sidebar-link">EventEmitter</a></li><li><a href="/blog/js/write/promise.html" class="sidebar-link">Promise</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其它</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js/other/tools.html" class="sidebar-link">网站指南</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="indexeddb"><a href="#indexeddb" class="header-anchor">#</a> IndexedDB</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p><strong>随着浏览器的发展，功能的不断增强，越来越多的网站开始考虑将数据存在本地（本人的使用也是基于此类，存储数据大概50m），而现有的存储方案都不适用于大量数据，例如Cookie存储的大小在4kb之间，LocalStorage的存储大概在2.5m-10m之间，具体看各家浏览器具体支持。因此IndexedDB就诞生了</strong></p> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p><strong>IndexedDB就是浏览器提供的本地数据库，它可以被网页脚本创建和操作。IndexedDB 允许储存大量数据，提供查找接口，还能建立索引。这些都是 LocalStorage 所不具备的。就数据库类型而言，IndexedDB 不属于关系型数据库（不支持 SQL 查询语句），更接近 NoSQL 数据库。</strong></p> <p><a href="https://wangdoc.com/javascript/bom/indexeddb.html" target="_blank" rel="noopener noreferrer">更详细的介绍及API请查看此链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h2> <p><strong>至此处，我们默认您已阅读过上述链接中api的基本用法</strong></p> <p><strong>完成数据的增删改查</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>姓名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addName<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>年龄<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addAge<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>唯一值id<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keyId<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>新增<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>update<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>更新<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>姓名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>find_result_from_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>find_block<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>find<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按照姓名查找数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> addName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;addName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> addAge <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;addAge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> addbtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> updatebtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> deletebtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;delete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span>  idVal <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;keyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> find <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;find&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> findResultFromName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;find_result_from_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> findBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;find_block&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> selectors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">createId</span><span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//用来生成唯一键id的方法</span>
	<span class="token keyword">return</span>  Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="打开数据库"><a href="#打开数据库" class="header-anchor">#</a> 打开数据库</h3> <p><strong>基本用法</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>databaseName<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>封装后我们返回db对象</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//databaseName 数据库名</span>
<span class="token comment">//storeName 表名</span>
<span class="token comment">//indexs 新建的索引列表</span>
	<span class="token keyword">function</span> <span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token parameter">databaseName<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>indexs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">try</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">//打开数据库之后返回这个对象仓库</span>
				<span class="token function">res</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开成功&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			  <span class="token keyword">var</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
			  <span class="token comment">//如果没有此张表则新建</span>
			  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				  <span class="token comment">//建表并确定id为主键</span>
			      <span class="token keyword">var</span> objstore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">&quot;id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				  indexs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment">//创建索引，unique: false表示此值可重复</span>
					objstore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">{</span>unique<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				  <span class="token punctuation">}</span><span class="token punctuation">)</span>
			    <span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="新增数据"><a href="#新增数据" class="header-anchor">#</a> 新增数据</h3> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>addName<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token operator">!</span>addAge<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;请输入姓名或者年龄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lenandlat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'lenandlat'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token function">createId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">:</span> addName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> age<span class="token operator">:</span> addAge<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据添加成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		addName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		addAge<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">;</span>
	  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">//我们创建了一个名为map，表名为lenandlat，索引为name和age的表</span>
	<span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span>indexs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		addbtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">add</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询数据"><a href="#查询数据" class="header-anchor">#</a> 查询数据</h3> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">function</span> <span class="token function">findObjFromKeyVal</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">res</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token function">rej</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span>indexs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		find<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">//在lenandlat这张表中，找到name为findResultFromName.value的那条数据并返回</span>
			<span class="token function">findObjFromKeyVal</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>findResultFromName<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
				findBlock<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				findBlock<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;没找到&quot;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="更新数据"><a href="#更新数据" class="header-anchor">#</a> 更新数据</h3> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">function</span> <span class="token function">ubdate</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>idVal<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;更新操作项需要唯一值id作为依托 ,请根据查询输入&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>addName<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token operator">!</span>addAge<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;请输入姓名或者年龄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lenandlat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'lenandlat'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token function">createId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">:</span> addName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> age<span class="token operator">:</span> addAge<span class="token punctuation">.</span>value<span class="token punctuation">,</span>id<span class="token operator">:</span>idVal<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//更新id为idVal.value的这条数据的姓名和年龄</span>
	  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据添加成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		addName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		addAge<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		idVal<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">;</span>
	  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span>indexs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		updatebtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ubdate</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="删除数据"><a href="#删除数据" class="header-anchor">#</a> 删除数据</h3> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">function</span> <span class="token function">deletefn</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>idVal<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;删除项需要唯一值id,请根据查询输入&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//如果id是表中一个不存在的值，也不会报错</span>
		<span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lenandlat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'lenandlat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>idVal<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			idVal<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据删除成功'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span>indexs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		deletebtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">deletefn</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询所有数据"><a href="#查询所有数据" class="header-anchor">#</a> 查询所有数据</h3> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">function</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span>storeName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">res</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h3> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">var</span> indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token parameter">databaseName<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>indexs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">try</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">res</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开成功&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			  <span class="token keyword">var</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
			  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			      <span class="token keyword">var</span> objstore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">&quot;id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				  indexs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					objstore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">{</span>unique<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				  <span class="token punctuation">}</span><span class="token punctuation">)</span>
			    <span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span>indexs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		updatebtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ubdate</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		deletebtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">deletefn</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		addbtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">add</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		find<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">findObjFromKeyVal</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>findResultFromName<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
				findBlock<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				findBlock<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;没找到&quot;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token function">findAll</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token string">&quot;lenandlat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	
	<span class="token keyword">function</span> <span class="token function">findObjFromKeyVal</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">res</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token function">rej</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
	
	<span class="token keyword">function</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span>storeName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">rej</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">res</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>addName<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token operator">!</span>addAge<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;请输入姓名或者年龄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lenandlat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'lenandlat'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token function">createId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">:</span> addName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> age<span class="token operator">:</span> addAge<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据添加成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		addName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		addAge<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">;</span>
	  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">ubdate</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>idVal<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;更新操作项需要唯一值id作为依托 ,请根据查询输入&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>addName<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token operator">!</span>addAge<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;请输入姓名或者年龄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lenandlat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'lenandlat'</span><span class="token punctuation">)</span>
	    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token function">createId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">:</span> addName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> age<span class="token operator">:</span> addAge<span class="token punctuation">.</span>value<span class="token punctuation">,</span>id<span class="token operator">:</span>idVal<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据添加成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		addName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		addAge<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		idVal<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">;</span>
	  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">deletefn</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>idVal<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;删除项需要唯一值id,请根据查询输入&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lenandlat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'lenandlat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>idVal<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			idVal<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据删除成功'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="具体测试用例"><a href="#具体测试用例" class="header-anchor">#</a> 具体测试用例</h3> <ul><li>1.我们首先打开了数据库map中表名为lenandlat，主键为id，索引值为name和age的一张表</li> <li>2.我们首先新增了2条数据，哈士奇 2，金毛 1</li> <li>3.我们根据查询，查询到姓名为金毛的数据，并拿到它的id，去修改</li> <li>4.我们也可以拿到某条数据的id，去删除它</li> <li>5.刷新页面，我们可以查询到所有的数据</li></ul> <p><strong>千般解说不如你试一试，感兴趣的可以复制上面的例子试一试</strong></p> <h2 id="本文具体实用的价值"><a href="#本文具体实用的价值" class="header-anchor">#</a> 本文具体实用的价值</h2> <p><strong>遇到的问题，高德地图中查询全国市级的经纬度并渲染，以我的电脑运行速度大概20秒以上才查询完，可以看到浏览器上面一直在转圈。而且由于数据大概有50M，所以indexedDB的方案是最好的。感兴趣的可以复制下面的例子</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;北京市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;天津市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;石家庄市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;唐山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;秦皇岛市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;邯郸市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;邢台市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;保定市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张家口市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;承德市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;沧州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;廊坊市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;衡水市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;太原市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;大同市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阳泉市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;长治市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;晋城市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;朔州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;晋中市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;运城市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;忻州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;临汾市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;吕梁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;呼和浩特市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;包头市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;乌海市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;赤峰市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;通辽市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鄂尔多斯市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;呼伦贝尔市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;巴彦淖尔市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;乌兰察布市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;兴安盟&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;锡林郭勒盟&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阿拉善盟&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;沈阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;大连市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鞍山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;抚顺市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;本溪市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;丹东市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;锦州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;营口市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阜新市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;辽阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;盘锦市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;铁岭市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;朝阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;葫芦岛市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;长春市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;吉林市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;四平市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;辽源市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;通化市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;白山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;松原市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;白城市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;延边朝鲜族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;哈尔滨市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;齐齐哈尔市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鸡西市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鹤岗市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;双鸭山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;大庆市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;伊春市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;佳木斯市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;七台河市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;牡丹江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黑河市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;绥化市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;大兴安岭地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;上海市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南京市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;无锡市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;徐州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;常州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;苏州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南通市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;连云港市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;淮安市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;盐城市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;扬州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;镇江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;泰州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宿迁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;杭州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宁波市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;温州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;嘉兴市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;湖州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;绍兴市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;金华市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;衢州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;舟山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;台州市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;丽水市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;合肥市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;芜湖市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;蚌埠市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;淮南市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;马鞍山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;淮北市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;铜陵市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;安庆市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黄山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;滁州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阜阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宿州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;六安市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;亳州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;池州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宣城市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;福州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;厦门市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;莆田市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三明市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;泉州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;漳州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南平市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;龙岩市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宁德市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南昌市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;景德镇市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;萍乡市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;九江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;新余市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鹰潭市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;赣州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;吉安市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;宜春市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;抚州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;上饶市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;济南市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;青岛市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;淄博市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;枣庄市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;东营市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;烟台市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;潍坊市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;济宁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;泰安市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;威海市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;日照市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;临沂市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;德州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;聊城市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;滨州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;菏泽市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;郑州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;开封市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;洛阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;平顶山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;安阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鹤壁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;新乡市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;焦作市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;濮阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;许昌市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;漯河市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三门峡市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;商丘市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;信阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;周口市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;驻马店市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;济源市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;武汉市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黄石市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;十堰市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宜昌市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;襄阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鄂州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;荆门市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;孝感市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;荆州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黄冈市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;咸宁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;随州市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;恩施土家族苗族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;仙桃市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;潜江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;天门市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;神农架林区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;长沙市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;株洲市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;湘潭市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;衡阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;邵阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;岳阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;常德市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张家界市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;益阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;郴州市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;永州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;怀化市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;娄底市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;湘西土家族苗族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;广州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;韶关市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;深圳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;珠海市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汕头市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;佛山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;江门市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;湛江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;茂名市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;肇庆市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;惠州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;梅州市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;汕尾市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;河源市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阳江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;清远市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;东莞市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;中山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;潮州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;揭阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;云浮市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南宁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;柳州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;桂林市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;梧州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;北海市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;防城港市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;钦州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;贵港市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;玉林市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;百色市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;贺州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;河池市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;来宾市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;崇左市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;海口市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三亚市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三沙市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;儋州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;五指山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;琼海市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;文昌市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;万宁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;东方市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;重庆市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;成都市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;自贡市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;攀枝花市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;泸州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;德阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;绵阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;广元市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;遂宁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;内江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;乐山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南充市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;眉山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宜宾市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;广安市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;达州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;雅安市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;巴中市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;资阳市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;阿坝藏族羌族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;甘孜藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;凉山彝族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;贵阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;六盘水市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;遵义市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;安顺市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;毕节市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;铜仁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黔西南布依族苗族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黔东南苗族侗族自治州&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;黔南布依族苗族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;昆明市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;曲靖市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;玉溪市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;保山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;昭通市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;丽江市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;普洱市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;临沧市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;楚雄彝族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;红河哈尼族彝族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;文山壮族苗族自治州&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;西双版纳傣族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;大理白族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;德宏傣族景颇族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;怒江傈僳族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;迪庆藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;拉萨市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;日喀则市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;昌都市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;林芝市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;山南市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;那曲市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阿里地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;西安市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;铜川市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;宝鸡市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;咸阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;渭南市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;延安市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汉中市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;榆林市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;安康市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;商洛市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;兰州市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;嘉峪关市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;金昌市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;白银市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;天水市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;武威市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张掖市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;平凉市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;酒泉市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;庆阳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;定西市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;陇南市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;临夏回族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;甘南藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;西宁市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;海东市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;海北藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黄南藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;海南藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;果洛藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;玉树藏族自治州&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;海西蒙古族藏族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;格尔木市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;银川市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;石嘴山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;吴忠市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;固原市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;中卫市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;乌鲁木齐市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;克拉玛依市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;吐鲁番市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;哈密市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;昌吉回族自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;博尔塔拉蒙古自治州&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;巴音郭楞蒙古自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阿克苏地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;克孜勒苏柯尔克孜自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;喀什地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;和田地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;伊犁哈萨克自治州&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;塔城地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阿勒泰地区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;石河子市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;阿拉尔市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;图木舒克市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;五家渠市&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;北屯市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;铁门关市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;双河市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;可克达拉市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;昆玉市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;香港特别行政区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;澳门特别行政区&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;定安县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;峨眉山市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;屯昌县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;澄迈县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;临高县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;白沙黎族自治县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;昌江黎族自治县&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;乐东黎族自治县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;陵水黎族自治县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;保亭黎族苗族自治县&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;琼中黎族苗族自治县&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!doctype html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>initial-scale=1.0, user-scalable=no, width=device-width<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>高德地图<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
			<span class="token selector">#map-container</span> <span class="token punctuation">{</span>
				<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
				<span class="token property">max-height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
				<span class="token property">height</span><span class="token punctuation">:</span> 920px<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>map-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//webapi.amap.com/maps?v=2.0&amp;key=fd63994802cd27736f049501c497c72c&amp;plugin=Map3D,AMap.DistrictSearch,AMap.Autocomplete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
			<span class="token keyword">import</span> citys <span class="token keyword">from</span> <span class="token string">&quot;./citys.js&quot;</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">'map-container'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
				resizeEnable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				viewMode<span class="token operator">:</span> <span class="token string">'3D'</span><span class="token punctuation">,</span>
				pitch<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
				zoom<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
				center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">114.308909</span><span class="token punctuation">,</span> <span class="token number">30.588336</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>

			<span class="token keyword">var</span> data <span class="token operator">=</span> citys<span class="token punctuation">;</span>
			<span class="token keyword">var</span> indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
			
			<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				AMap<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'AMap.DistrictSearch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">var</span> district <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>DistrictSearch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						extensions<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
						level<span class="token operator">:</span> <span class="token string">'city'</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token keyword">var</span>  start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
						<span class="token comment">/*
						如果解开此处并且把下面的注释，会得到纯查询的速度
						district.search(item, function(status, result) {
							console.log(Date.now()-start)
							renderBounce(result)		
						})
						*/</span>
						<span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;citys&quot;</span><span class="token punctuation">,</span>indexs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token function">findObjFromKeyVal</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token string">&quot;citys&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
								<span class="token keyword">var</span>  result <span class="token operator">=</span> data<span class="token punctuation">.</span>info<span class="token punctuation">;</span>
								console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">)</span>
								<span class="token comment">//如果查询到就直接渲染</span>
								<span class="token function">renderBounce</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>	
							<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
								<span class="token comment">//如果没找到，就直接查询，并且存入本地数据库</span>
								district<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">status<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
									<span class="token function">addCityInfo</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span><span class="token string">&quot;citys&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token function">createId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>city<span class="token operator">:</span>item<span class="token punctuation">,</span>info<span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>		
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">//如果打开数据库失败，则直接查询</span>
							district<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">status<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token function">renderBounce</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>		
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">function</span> <span class="token function">renderBounce</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> bounds <span class="token operator">=</span> result<span class="token punctuation">.</span>districtList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>boundaries<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bounds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> bounds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">var</span> polygon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
							map<span class="token operator">:</span> map<span class="token punctuation">,</span>
							strokeWeight<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
							path<span class="token operator">:</span> bounds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
							fillOpacity<span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
							fillColor<span class="token operator">:</span> <span class="token string">'#0088ff'</span><span class="token punctuation">,</span>
							strokeColor<span class="token operator">:</span> <span class="token string">'#CC66CC'</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>	
			<span class="token punctuation">}</span>
			<span class="token keyword">function</span> <span class="token function">createId</span><span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span>  Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">function</span> <span class="token function">addCityInfo</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
				  <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span>
				  <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
					
				request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
					
				request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">function</span> <span class="token function">findObjFromKeyVal</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>storeName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
					request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token function">res</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
							<span class="token function">rej</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">function</span> <span class="token function">openIndexDb</span><span class="token punctuation">(</span><span class="token parameter">databaseName<span class="token punctuation">,</span>storeName<span class="token punctuation">,</span>indexs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">try</span><span class="token punctuation">{</span>
						<span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
					request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
					request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token function">res</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开成功&quot;</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
					request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					  <span class="token keyword">var</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
					  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					      <span class="token keyword">var</span> objstore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">&quot;id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						  indexs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							objstore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">{</span>unique<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						  <span class="token punctuation">}</span><span class="token punctuation">)</span>
					    <span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>

		</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="未完待续···"><a href="#未完待续···" class="header-anchor">#</a> 未完待续···</h3></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/atJiangBei/blog/edit/master/docs/js/advanced/indexeddb.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-8-26 19:40:25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/js/advanced/eventloop.html" class="prev">
        事件循环
      </a></span> <span class="next"><a href="/blog/js/advanced/webworkers.html">
        WebWorker
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.71c01b6c.js" defer></script><script src="/blog/assets/js/2.c0191e23.js" defer></script><script src="/blog/assets/js/10.769c860c.js" defer></script><script src="/blog/assets/js/3.d0de4903.js" defer></script>
  </body>
</html>
