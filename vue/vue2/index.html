<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue2.x | æ±ŸåŒ—</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/blog/imgs/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="ä¸ºä¸­åæ°‘æ—ä¹‹å´›èµ·è€ŒåŠªåŠ›">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/blog/assets/css/0.styles.d0858680.css" as="style"><link rel="preload" href="/blog/assets/js/app.71c01b6c.js" as="script"><link rel="preload" href="/blog/assets/js/2.c0191e23.js" as="script"><link rel="preload" href="/blog/assets/js/31.a00248a5.js" as="script"><link rel="preload" href="/blog/assets/js/3.d0de4903.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.769c860c.js"><link rel="prefetch" href="/blog/assets/js/11.cd7e6c2a.js"><link rel="prefetch" href="/blog/assets/js/12.f749abcc.js"><link rel="prefetch" href="/blog/assets/js/13.c253f91b.js"><link rel="prefetch" href="/blog/assets/js/14.79b103e2.js"><link rel="prefetch" href="/blog/assets/js/15.ee52efe2.js"><link rel="prefetch" href="/blog/assets/js/16.072b1975.js"><link rel="prefetch" href="/blog/assets/js/17.3abdce12.js"><link rel="prefetch" href="/blog/assets/js/18.fa0a5edd.js"><link rel="prefetch" href="/blog/assets/js/19.aa388fcf.js"><link rel="prefetch" href="/blog/assets/js/20.8f02659c.js"><link rel="prefetch" href="/blog/assets/js/21.04293f5c.js"><link rel="prefetch" href="/blog/assets/js/22.bfa07d9c.js"><link rel="prefetch" href="/blog/assets/js/23.f1dbad04.js"><link rel="prefetch" href="/blog/assets/js/24.73dc77c1.js"><link rel="prefetch" href="/blog/assets/js/25.fcbe3b22.js"><link rel="prefetch" href="/blog/assets/js/26.7ab6cc65.js"><link rel="prefetch" href="/blog/assets/js/27.10aeb5e9.js"><link rel="prefetch" href="/blog/assets/js/28.51925612.js"><link rel="prefetch" href="/blog/assets/js/29.d20fc77f.js"><link rel="prefetch" href="/blog/assets/js/30.b754a29e.js"><link rel="prefetch" href="/blog/assets/js/32.154f3b00.js"><link rel="prefetch" href="/blog/assets/js/33.243d641d.js"><link rel="prefetch" href="/blog/assets/js/4.858f4870.js"><link rel="prefetch" href="/blog/assets/js/5.23f973fb.js"><link rel="prefetch" href="/blog/assets/js/6.a37f274f.js"><link rel="prefetch" href="/blog/assets/js/7.f00de9bb.js"><link rel="prefetch" href="/blog/assets/js/8.88b80aa7.js"><link rel="prefetch" href="/blog/assets/js/9.a18ffa96.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.d0858680.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">æ±ŸåŒ—</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/js/basic/" class="nav-link">
  æŒ‡å—
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue List" class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue2/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/vue3/" class="nav-link">
  vue3.x
</a></li></ul></div></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Js List" class="dropdown-title"><span class="title">é¢è¯•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/questions/js/" class="nav-link">
  åŸç”Ÿjs
</a></li><li class="dropdown-item"><!----> <a href="/blog/questions/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">ç®—æ³•ç¯‡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/leetcode/array/" class="nav-link">
  æ•°ç»„
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/string/" class="nav-link">
  å­—ç¬¦ä¸²
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/list/" class="nav-link">
  é“¾è¡¨
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/tree/" class="nav-link">
  æ ‘
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/other/" class="nav-link">
  å…¶å®ƒ
</a></li></ul></div></div><div class="nav-item"><a href="https://jiangbei.online" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä¸ªäººä¸»é¡µ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/atjiangbei/blog/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ›´æ–°è®°å½•
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue2/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/blog/en.html" class="nav-link">
  en-US
</a></li></ul></div></div> <a href="https://github.com/atJiangBei/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/js/basic/" class="nav-link">
  æŒ‡å—
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue List" class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue2/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/vue3/" class="nav-link">
  vue3.x
</a></li></ul></div></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Js List" class="dropdown-title"><span class="title">é¢è¯•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/questions/js/" class="nav-link">
  åŸç”Ÿjs
</a></li><li class="dropdown-item"><!----> <a href="/blog/questions/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">ç®—æ³•ç¯‡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/leetcode/array/" class="nav-link">
  æ•°ç»„
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/string/" class="nav-link">
  å­—ç¬¦ä¸²
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/list/" class="nav-link">
  é“¾è¡¨
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/tree/" class="nav-link">
  æ ‘
</a></li><li class="dropdown-item"><!----> <a href="/blog/leetcode/other/" class="nav-link">
  å…¶å®ƒ
</a></li></ul></div></div><div class="nav-item"><a href="https://jiangbei.online" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä¸ªäººä¸»é¡µ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/atjiangbei/blog/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ›´æ–°è®°å½•
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/vue2/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/blog/en.html" class="nav-link">
  en-US
</a></li></ul></div></div> <a href="https://github.com/atJiangBei/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue2.x</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/vue/vue2/#è™šæ‹Ÿdom" class="sidebar-link">è™šæ‹Ÿdom</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom" class="sidebar-link">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom</a></li></ul></li><li><a href="/blog/vue/vue2/#å¦‚ä½•é€šè¿‡thisæ‹¿åˆ°å½“å‰dataä¸‹é¢çš„å€¼" class="sidebar-link">å¦‚ä½•é€šè¿‡thisæ‹¿åˆ°å½“å‰dataä¸‹é¢çš„å€¼</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/vue/vue2/#å“åº”å¼çš„æ•°ç»„" class="sidebar-link">å“åº”å¼çš„æ•°ç»„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#æ”¯æŒ-proto" class="sidebar-link">æ”¯æŒ_proto_</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#ä¸æ”¯æŒ-proto-æ—¶" class="sidebar-link">ä¸æ”¯æŒ_proto_æ—¶</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#æœ¬åœ°æµ‹è¯•" class="sidebar-link">æœ¬åœ°æµ‹è¯•</a></li></ul></li><li><a href="/blog/vue/vue2/#vue2-xä¹‹nexttick" class="sidebar-link">vue2.xä¹‹nextTick</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#vueå†…éƒ¨ä¸ºä»€ä¹ˆè¦å¼•å…¥-nexttick" class="sidebar-link">vueå†…éƒ¨ä¸ºä»€ä¹ˆè¦å¼•å…¥ nextTick</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#nexttick" class="sidebar-link">nextTick</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#æš´éœ²å‡ºæ¥çš„api-nexttick" class="sidebar-link">æš´éœ²å‡ºæ¥çš„api nextTick</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#æºç å†…éƒ¨çš„timerfnå‡½æ•°æœ‰æ—¶å€™æ˜¯å®ä»»åŠ¡-æœ‰æ—¶å€™æ˜¯å¾®ä»»åŠ¡" class="sidebar-link">æºç å†…éƒ¨çš„timerFnå‡½æ•°æœ‰æ—¶å€™æ˜¯å®ä»»åŠ¡,æœ‰æ—¶å€™æ˜¯å¾®ä»»åŠ¡</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#vue-nexttickçš„å†å²" class="sidebar-link">vue nextTickçš„å†å²</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#_2-4ç‰ˆæœ¬" class="sidebar-link">2.4ç‰ˆæœ¬</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#_2-5ç‰ˆæœ¬" class="sidebar-link">2.5ç‰ˆæœ¬</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#_2-61ç‰ˆæœ¬" class="sidebar-link">2.61ç‰ˆæœ¬</a></li></ul></li><li><a href="/blog/vue/vue2/#vue2-xä¹‹diffç®—æ³•" class="sidebar-link">vue2.xä¹‹diffç®—æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶æ¸²æŸ“åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸Š" class="sidebar-link">åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶æ¸²æŸ“åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸Š</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#é€šè¿‡diffç®—æ³•ä¼˜åŒ–æ›´æ–°" class="sidebar-link">é€šè¿‡diffç®—æ³•ä¼˜åŒ–æ›´æ–°</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#å¯¹æ¯”æ›´æ–°å­èŠ‚ç‚¹" class="sidebar-link">å¯¹æ¯”æ›´æ–°å­èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#å®Œæ•´ä»£ç " class="sidebar-link">å®Œæ•´ä»£ç </a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#å…³äºkey" class="sidebar-link">å…³äºkey</a></li><li class="sidebar-sub-header"><a href="/blog/vue/vue2/#ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸å»ºè®®ç”¨indexä½œä¸ºkey" class="sidebar-link">ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸å»ºè®®ç”¨indexä½œä¸ºkey</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue2-x"><a href="#vue2-x" class="header-anchor">#</a> vue2.x</h1> <h2 id="è™šæ‹Ÿdom"><a href="#è™šæ‹Ÿdom" class="header-anchor">#</a> è™šæ‹Ÿdom</h2> <p><strong>æˆ‘ä»¬æ‹¿vue2.xçš„æºç æ¥çœ‹ä¸€ä¸‹vueæ˜¯å¦‚ä½•ç”¨jså¯¹è±¡è¡¨ç¤ºè™šæ‹Ÿdomçš„</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter">tag<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    data<span class="token operator">?</span><span class="token operator">:</span> VNodeData<span class="token punctuation">,</span>
    children<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token builtin">Array</span><span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    elm<span class="token operator">?</span><span class="token operator">:</span> Node<span class="token punctuation">,</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data
    <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> children
    <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
    <span class="token keyword">this</span><span class="token punctuation">.</span>elm <span class="token operator">=</span> elm
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>key
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>ä»¥ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šè™šæ‹Ÿdomå°±æ˜¯æˆ‘ä»¬ç”¨jså¯¹è±¡çš„æ–¹å¼æ¥è¡¨ç¤ºhtml domå¯¹è±¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆ è¦ä½¿ç”¨è™šæ‹Ÿdomå‘¢ï¼Ÿ</strong></p> <h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom" class="header-anchor">#</a> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom</h3> <p>ä¹Ÿè®¸ä½ ç°åœ¨æ‰“å¼€æœç´¢ä¾æ—§å¯ä»¥çœ‹åˆ°nå¤šä¸ªå›ç­”å‘Šè¯‰ä½ ï¼Œæ“ä½œçœŸå®domçš„ä»£ä»·å¦‚ä½•å¦‚ä½•å¤§ï¼Œä¸ºäº†æ€§èƒ½ï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨è™šæ‹Ÿdomï¼ŒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ
è¿™æ ·çš„è§£é‡Šä¸èƒ½è¯´æ˜¯é”™çš„ï¼Œä½†æ˜¯å¹¶ä¸å®Œå…¨æ­£ç¡®ï¼Œæ¯•ç«Ÿå¯¹äºæ¡†æ¶æ“ä½œè™šæ‹Ÿdomè€Œè¨€ã€ç›´æ¥åŸç”Ÿæ“ä½œdomæ¥è¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–æ–¹å¼é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯å¦‚æœæ•°æ®é‡å¤§åˆ°ä¸€å®šç¨‹åº¦ä¹ƒè‡³é¡µé¢ä¸Šå¤æ‚åˆ°ä¸€å®šç¨‹åº¦ï¼Œ
éš¾é“ä½ æ¬¡éƒ½è¦é€‰å–å¯¹åº”çš„domå»æ›´æ”¹å—ï¼Œæˆ–è€…æ˜¯ç›´æ¥å»æ›´æ”¹æ•´ä¸ªinnerHTMLï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç‰¹å®šçš„å»ä¼˜åŒ–ä»£ç ï¼Œä½†æ˜¯ï¼Œéš¾é“ä½ è¦å†æ¯ä¸ªåœ°æ–¹éƒ½å»æ‰‹åŠ¨çš„ä¼˜åŒ–è¿™äº›å—ï¼Ÿè¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œ
æ¡†æ¶ç»™æˆ‘ä»¬çš„ä¿è¯æ˜¯ï¼Œåœ¨ä¸éœ€è¦ä½ æ‰‹åŠ¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä¾æ—§ç»™ä½ è¿‡çš„å»çš„æ€§èƒ½ï¼Œè™šæ‹Ÿdomçš„çœŸæ­£ä»·å€¼ä»æ¥éƒ½ä¸æ˜¯æ€§èƒ½ï¼Œ1.å‡½æ•°å¼ç¼–ç¨‹å¸¦æ¥çš„å¯ç»´æŠ¤æ€§ã€‚2.è®©jså¯ä»¥æ¸²æŸ“åˆ° DOM ä»¥å¤–çš„åœ°æ–¹ã€‚</p> <p>ä»¥ä¸Š<a href="https://www.zhihu.com/question/31809713/answer/53544875" target="_blank" rel="noopener noreferrer">å‚è€ƒé“¾æ¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>é’ˆå¯¹è™šæ‹Ÿdomï¼Œvueå†…éƒ¨å…·ä½“åšäº†é‚£äº›ä¼˜åŒ–ï¼Œè¯·çœ‹ä¸‹æ–‡çš„diffç®—æ³•ç¯‡</strong></p> <h2 id="å¦‚ä½•é€šè¿‡thisæ‹¿åˆ°å½“å‰dataä¸‹é¢çš„å€¼"><a href="#å¦‚ä½•é€šè¿‡thisæ‹¿åˆ°å½“å‰dataä¸‹é¢çš„å€¼" class="header-anchor">#</a> å¦‚ä½•é€šè¿‡thisæ‹¿åˆ°å½“å‰dataä¸‹é¢çš„å€¼</h2> <p><strong>ç¤ºä¾‹</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	el<span class="token operator">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">{</span>
			name<span class="token operator">:</span><span class="token string">'vue'</span>
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	methods<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span><span class="token comment">// 'vue'</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>å¾ˆç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šæºç å§ï¼ˆğŸ˜Šï¼‰</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/core/instance/state.js</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data
  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span>
    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

 <span class="token comment">// proxy data on instance</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props
  <span class="token keyword">const</span> methods <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>methods
  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Method &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; has already been defined as a data property.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The data property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already declared as a prop. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use prop default value instead.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isReserved</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


</code></pre></div><p>æˆ‘ä»¬åªåˆ†æä¸æœ¬èŠ‚ç›¸å…³çš„å†…å®¹</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span>
    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
<span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
	
	<span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>æˆ‘ä»¬æ‹¿åˆ°äº†dataçš„å€¼ï¼Œç„¶åéå†å®ƒï¼Œæœ€åæˆ‘ä»¬æ‰§è¡Œproxyæ–¹æ³•ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹proxyæ–¹æ³•</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token operator">:</span> noop<span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token operator">:</span> noop
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Object<span class="token punctuation">,</span> sourceKey<span class="token operator">:</span> string<span class="token punctuation">,</span> key<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>ä»¥ä¸Šï¼Œå½“æˆ‘ä»¬åœ¨å–this.nameå¾—æ—¶å€™ï¼Œé€šè¿‡Object.definePropertyè¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ— è®ºåœ¨å­˜å–å€¼å¾—æ—¶å€™ï¼Œéƒ½æ˜¯å¯¹å½“å‰å®ä¾‹ä¸‹çš„dataæ“ä½œçš„</p> <h2 id="å“åº”å¼çš„æ•°ç»„"><a href="#å“åº”å¼çš„æ•°ç»„" class="header-anchor">#</a> å“åº”å¼çš„æ•°ç»„</h2> <ul><li>ä¼—æ‰€å‘¨çŸ¥ï¼Œvue2.xçš„å“åº”å¼æ˜¯é€šè¿‡Object.definePropertyæ–¹æ³•å®ç°çš„ï¼Œä½†æ˜¯æ­¤æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒæ— æ³•ç›‘æµ‹æ•°ç»„çš„å˜åŒ–ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹vueæ˜¯å¦‚ä½•ç›‘æµ‹å®ä¾‹å†…æ•°ç»„å˜åŒ–ä»è€Œåšå‡ºå“åº”çš„</li></ul> <p><strong>å…ˆçœ‹ä¸€ä¸ªç¤ºä¾‹</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	el<span class="token operator">:</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
	template<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
	&lt;div&gt;
		&lt;span v-for=&quot;(item,index) in list&quot;&gt;{{ item }}&lt;/span&gt;
		&lt;button @click=&quot;change&quot;&gt;æ”¹å˜æ•°æ®&lt;/button&gt;
	&lt;/div&gt;
	</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">{</span>
			list<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	methods<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">)</span>
			<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'d'</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//a,d,c</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><p>ä»¥ä¸Šï¼Œå½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®åï¼Œæ‰§è¡Œchangeæ–¹æ³•ï¼Œé¡µé¢ä¼šæ¸²æŸ“ä¸º</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>ä¸¤ç§’åï¼Œç¬¬äºŒä¸ªspançš„å†…å®¹å´ä¾ç„¶æ˜¯bï¼Œè€Œä¸æ˜¯dï¼Œç„¶è€Œæˆ‘ä»¬è¾“å‡ºlistå‘ç°ï¼Œæ•°æ®å·²ç»å˜ä¸º[a,d,c]ï¼Œä¸ºä»€ä¹ˆæ•°æ®æ”¹å˜è€Œå†…å®¹å´æ²¡æœ‰æ›´æ–°å‘¢</li> <li>æˆ‘ä»¬çœ‹ä¸€ä¸‹vueå†…éƒ¨æ˜¯æ€ä¹ˆå®ç°ç›‘å¬çš„</li></ul> <p><strong>åˆå§‹åŒ–æ•°æ®çš„æ—¶å€™ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/core/instance/state.js</span>

<span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//Â·Â·Â·</span>
<span class="token comment">//...</span>
  <span class="token comment">// observe data</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//observeæ–¹æ³•</span>
<span class="token comment">// src/core/observer/index.js</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any<span class="token punctuation">,</span> asRootData<span class="token operator">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">//Â·Â·Â·</span>
  ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token comment">//Â·Â·Â·</span>
<span class="token punctuation">}</span>

<span class="token comment">// class Observer</span>
<span class="token comment">//</span>

<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> any<span class="token punctuation">;</span>
  dep<span class="token operator">:</span> Dep<span class="token punctuation">;</span>
  vmCount<span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that have this object as root $data</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Walk through all properties and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Observe a list of Array items.
   */</span>
  <span class="token function">observeArray</span> <span class="token punctuation">(</span><span class="token parameter">items<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>ä»¥ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œå½“å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœåˆ¤æ–­å½“å‰æ•°æ®æ˜¯ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å°†ä¼šèµ°è¿™å‡ è¡Œä»£ç </p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">if</span> <span class="token punctuation">(</span>hasProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

</code></pre></div><h3 id="æ”¯æŒ-proto"><a href="#æ”¯æŒ-proto" class="header-anchor">#</a> æ”¯æŒ__proto__</h3> <p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒhasProtoï¼ˆåˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒ__proto__å±æ€§ï¼‰éƒ½ä¼šä¸ºtrueï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹protoAugment(value, arrayMethods)åšäº†ä»€ä¹ˆ</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/core/observer/index.js</span>
<span class="token comment">/**
 * Augment a target Object or Array by intercepting
 * the prototype chain using __proto__
 */</span>
<span class="token keyword">function</span> <span class="token function">protoAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> src<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* eslint-disable no-proto */</span>
  target<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> src
  <span class="token comment">/* eslint-enable no-proto */</span>
<span class="token punctuation">}</span>

</code></pre></div><p>å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ–¹æ³•åªæ˜¯æŠŠå½“å‰arrayçš„åŸå‹è®¾ä¸º arrayMethodsï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ arrayMethods</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/core/observer/array.js</span>
<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span>

<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'push'</span><span class="token punctuation">,</span>
  <span class="token string">'pop'</span><span class="token punctuation">,</span>
  <span class="token string">'shift'</span><span class="token punctuation">,</span>
  <span class="token string">'unshift'</span><span class="token punctuation">,</span>
  <span class="token string">'splice'</span><span class="token punctuation">,</span>
  <span class="token string">'sort'</span><span class="token punctuation">,</span>
  <span class="token string">'reverse'</span>
<span class="token punctuation">]</span>

<span class="token comment">/**
 * Intercept mutating methods and emit events
 */</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// cache original method</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
    <span class="token keyword">let</span> inserted
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
    <span class="token comment">// notify change</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//def</span>

<span class="token keyword">function</span> <span class="token function">def</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> string<span class="token punctuation">,</span> val<span class="token operator">:</span> any<span class="token punctuation">,</span> enumerable<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> val<span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre></div><p>**åˆ†æï¼š**ä»¥ä¸Šæˆ‘ä»¬æ˜¾ç¤ºæ‹¿åˆ°äº†Arrayçš„åŸå‹å¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬å†æŠŠæ­¤å¯¹è±¡è®¾ç½®ä¸ºarrayMethodsçš„åŸå‹ï¼Œ
æ­¤æ—¶ï¼ŒarrayMethodsæ˜¯è¿™ä¸ªæ ·å­</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token punctuation">{</span>
	__proto__<span class="token operator">:</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		concat<span class="token operator">:</span> Æ’ <span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		constructor<span class="token operator">:</span> Æ’ <span class="token function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		copyWithin<span class="token operator">:</span> Æ’ <span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		entries<span class="token operator">:</span> Æ’ <span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		every<span class="token operator">:</span> Æ’ <span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fill<span class="token operator">:</span> Æ’ <span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		filter<span class="token operator">:</span> Æ’ <span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		find<span class="token operator">:</span> Æ’ <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		findIndex<span class="token operator">:</span> Æ’ <span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		flat<span class="token operator">:</span> Æ’ <span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		flatMap<span class="token operator">:</span> Æ’ <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		forEach<span class="token operator">:</span> Æ’ <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		includes<span class="token operator">:</span> Æ’ <span class="token function">includes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		indexOf<span class="token operator">:</span> Æ’ <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		join<span class="token operator">:</span> Æ’ <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		keys<span class="token operator">:</span> Æ’ <span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		lastIndexOf<span class="token operator">:</span> Æ’ <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		length<span class="token operator">:</span> <span class="token number">0</span>
		map<span class="token operator">:</span> Æ’ <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		pop<span class="token operator">:</span> Æ’ <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>ç„¶åæˆ‘ä»¬åœ¨éå†methodsToPatchçš„æ—¶å€™æ‰§è¡Œdefæ–¹æ³•åï¼ŒarrayMethodså¦‚ä¸‹</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token punctuation">{</span>
	pop<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	push<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	reverse<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	shift<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	sort<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	splice<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	unshift<span class="token operator">:</span> Æ’ <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
	__proto__<span class="token operator">:</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		concat<span class="token operator">:</span> Æ’ <span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		constructor<span class="token operator">:</span> Æ’ <span class="token function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		copyWithin<span class="token operator">:</span> Æ’ <span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		entries<span class="token operator">:</span> Æ’ <span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		every<span class="token operator">:</span> Æ’ <span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fill<span class="token operator">:</span> Æ’ <span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		filter<span class="token operator">:</span> Æ’ <span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		find<span class="token operator">:</span> Æ’ <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		findIndex<span class="token operator">:</span> Æ’ <span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		flat<span class="token operator">:</span> Æ’ <span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		flatMap<span class="token operator">:</span> Æ’ <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		forEach<span class="token operator">:</span> Æ’ <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		includes<span class="token operator">:</span> Æ’ <span class="token function">includes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		indexOf<span class="token operator">:</span> Æ’ <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		join<span class="token operator">:</span> Æ’ <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		keys<span class="token operator">:</span> Æ’ <span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		lastIndexOf<span class="token operator">:</span> Æ’ <span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		length<span class="token operator">:</span> <span class="token number">0</span>
		map<span class="token operator">:</span> Æ’ <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		pop<span class="token operator">:</span> Æ’ <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre></div><p>æ­¤æ—¶pushï¼Œpopï¼Œshiftï¼Œunshiftï¼Œspliceï¼Œsortï¼Œreverseç­‰æ–¹æ³•éƒ½é‡å†™ä¸ºäº†mutatorå‡½æ•°</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
	<span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
	<span class="token keyword">let</span> inserted
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
	  <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
		inserted <span class="token operator">=</span> args
		<span class="token keyword">break</span>
	  <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
		inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token keyword">break</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
	<span class="token comment">// notify change</span>
	ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> result
<span class="token punctuation">}</span>

</code></pre></div><p>å›åˆ°æœ€åˆï¼Œå½“æˆ‘ä»¬åœ¨æ‰§è¡ŒprotoAugment(value, arrayMethods)æ–¹æ³•æ—¶ï¼Œå°±æ˜¯æŠŠæ•°ç»„valueçš„åŸå‹æŒ‡å‘äº†arrayMethodsï¼Œ
æ‰€ä»¥åœ¨æ“ä½œæ•°ç»„pushï¼Œpopï¼Œshift...è¿™äº›æ–¹æ³•æ—¶æˆ‘ä»¬å¯ä»¥åœ¨mutatorå†…éƒ¨åšä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ob.dep.notify()é€šçŸ¥æ›´æ–°</p> <h3 id="ä¸æ”¯æŒ-proto-æ—¶"><a href="#ä¸æ”¯æŒ-proto-æ—¶" class="header-anchor">#</a> ä¸æ”¯æŒ__proto__æ—¶</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">def</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> string<span class="token punctuation">,</span> val<span class="token operator">:</span> any<span class="token punctuation">,</span> enumerable<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> val<span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">copyAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Object<span class="token punctuation">,</span> src<span class="token operator">:</span> Object<span class="token punctuation">,</span> keys<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token function">def</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> arrayKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">)</span>
<span class="token comment">//arrayKeys-&gt; [&quot;push&quot;, &quot;pop&quot;, &quot;shift&quot;, &quot;unshift&quot;, &quot;splice&quot;, &quot;sort&quot;, &quot;reverse&quot;]</span>
<span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>

</code></pre></div><p>**åˆ†æï¼š**å½“æµè§ˆå™¨ä¸æ”¯æŒç›´æ¥æŠŠæ•°ç»„åŸå‹ä»¥__proto__çš„å½¢å¼æŒ‡å‘arrayMethodsæ—¶ï¼Œæˆ‘ä»¬å°±ç›´æ¥ç»™å½“å‰æ•°ç»„æœ¬èº«æ·»åŠ è¿™äº›ç»è¿‡æˆ‘ä»¬æ”¹å†™çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯mutatorå‡½æ•°</p> <ul><li>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨vue2.xé‡Œé¢ï¼Œæˆ‘ä»¬ç›´æ¥this.arr[i] = xxx å¹¶ä¸èƒ½è®©è§†å›¾å“åº”çš„åŸå› </li></ul> <h3 id="æœ¬åœ°æµ‹è¯•"><a href="#æœ¬åœ°æµ‹è¯•" class="header-anchor">#</a> æœ¬åœ°æµ‹è¯•</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'splice'</span><span class="token punctuation">,</span><span class="token string">'push'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prototypeArray <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token keyword">const</span> protoArray <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>prototypeArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">setValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		value<span class="token operator">:</span> value<span class="token punctuation">,</span>
		enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		configurable<span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arrayMethods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> original <span class="token operator">=</span> prototypeArray<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
	<span class="token function">setValue</span><span class="token punctuation">(</span>protoArray<span class="token punctuation">,</span>method<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arg<span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æ‰§è¡Œäº†</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">æ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ä¸º</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

arr<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> protoArray

arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œäº†pushæ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ä¸º4</span>
arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œäº†spliceæ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ä¸º3,1</span>

</code></pre></div><p><strong>æ³¨æ„ï¼šè¿™æ ·æˆ‘ä»¬åœ¨è°ƒç”¨call,pushç­‰æ–¹æ³•æ—¶ï¼Œå°±ä¸€å®šè¦è°ƒç”¨æˆ‘ä»¬æ”¹å†™è¿‡çš„æ–¹æ³•ï¼Œè¯·çœ‹ä¸‹é¢ç¤ºä¾‹</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¹¶ä¸ä¼šè§¦å‘æˆ‘ä»¬çš„è¾“å‡ºï¼Œå› ä¸ºæ­¤æ—¶è°ƒç”¨çš„æ˜¯åŸå§‹pushçš„æ–¹æ³•</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1, 2, 3, 5, 6]</span>
arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œäº†pushæ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ä¸º7,8,9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1, 2, 3, 5, 6, 7, 8, 9]</span>

</code></pre></div><h2 id="vue2-xä¹‹nexttick"><a href="#vue2-xä¹‹nexttick" class="header-anchor">#</a> vue2.xä¹‹nextTick</h2> <p>ä¹Ÿçœ‹è¿‡ä¸å°‘ä»‹ç»nextTickçš„æ–‡ç« ï¼Œæ„Ÿè§‰éƒ½ä¸å¤ªå®Œæ•´ï¼Œå¯èƒ½ä»‹ç»äº†ä¸ºä»€ä¹ˆç»™æˆ‘ä»¬æš´éœ²äº†è¿™ä¸ªapiï¼Œå´æ²¡æœ‰ä»‹ç»å†…éƒ¨ä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™ä¸ªapiï¼Œå†…éƒ¨å¼•å…¥è¿™ä¸ªapiåšäº†ä»€ä¹ˆ</p> <ul><li><strong>æœ¬æ–‡é»˜è®¤è¯»è€…å·²ç»ç†è§£äº†jså®ä»»åŠ¡å’Œå¾®ä»»åŠ¡çš„åŸºæœ¬æ¦‚å¿µ</strong></li> <li><strong>æœ¬æ–‡é»˜è®¤è¯»è€…ç†Ÿç»ƒè¿ç”¨nextTickè¿™ä¸ªapi</strong></li> <li><strong>æœ¬æ–‡é»˜è®¤æ‚¨å·²ç†Ÿæ‚‰vue2çš„å“åº”å¼åŸç†</strong></li></ul> <h3 id="vueå†…éƒ¨ä¸ºä»€ä¹ˆè¦å¼•å…¥-nexttick"><a href="#vueå†…éƒ¨ä¸ºä»€ä¹ˆè¦å¼•å…¥-nexttick" class="header-anchor">#</a> vueå†…éƒ¨ä¸ºä»€ä¹ˆè¦å¼•å…¥ nextTick</h3> <p>vueçš„å“åº”å¼åŸç†å°±ä¸å†èµ˜è¿°ï¼Œå…ˆçœ‹ä¸€æ®µä»£ç </p> <p>å‡è®¾æˆ‘ä»¬çš„domå¦‚ä¸‹æ‰€ç¤º</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//æˆ‘ä»¬å…ˆè·å–ä¸€ä¸‹dom</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºdataæ•°æ®</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
	count<span class="token operator">:</span><span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ¸²æŸ“å‡½æ•°</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ¸²æŸ“&quot;</span><span class="token punctuation">)</span>
	app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ›´æ–°å‡½æ•°</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å“åº”å¼å‡½æ•°</span>

<span class="token keyword">function</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span>key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token keyword">set</span><span class="token punctuation">(</span>nvl<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>nvl <span class="token operator">===</span> val<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			val <span class="token operator">=</span> nvl<span class="token punctuation">;</span>
			<span class="token comment">//æ•°æ®ä¿®æ”¹æ—¶æ‰§è¡Œæˆ‘ä»¬çš„æ›´æ–°å‡½æ•°</span>
			<span class="token function">update</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> val
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//åŠ«æŒæˆ‘ä»¬çš„æ•°æ®å¯¹è±¡</span>

<span class="token function">define</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">//æ‰§è¡Œæ¸²æŸ“å‡½æ•°</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//è¾“å‡ºï¼šæ¸²æŸ“</span>

<span class="token comment">/*
æ­¤æ—¶çš„dom
&lt;div id=&quot;app&quot;&gt;0&lt;/div&gt;
*/</span>

</code></pre></div><p><strong>ä»¥ä¸Šï¼šæˆ‘ä»¬å…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡dataï¼Œç„¶åæŒ‰ç…§å›½é™…æƒ¯ä¾‹åŠ«æŒå®ƒçš„countå±æ€§ï¼Œåœ¨countæ”¹å˜æ—¶ï¼Œæˆ‘ä»¬å»æ›´æ–°dom</strong></p> <p>æµ‹è¯•ï¼šæ­¤æ—¶appçš„å†…å®¹ä¸º0ï¼Œæˆ‘ä»¬åœ¨ä¸€ç§’åå»æ›´æ”¹countçš„å€¼</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">/*
æ­¤æ—¶çš„dom
&lt;div id=&quot;app&quot;&gt;3&lt;/div&gt;
*/</span>

<span class="token comment">//å†æ¬¡è¾“å‡ºä¸‰æ¬¡æ¸²æŸ“</span>
<span class="token string">&quot;æ¸²æŸ“&quot;</span>
<span class="token string">&quot;æ¸²æŸ“&quot;</span>
<span class="token string">&quot;æ¸²æŸ“&quot;</span>

</code></pre></div><p><strong>ä»¥ä¸Šï¼šæˆ‘ä»¬ä¸€å…±æ›´æ–°äº†ä¸‰æ¬¡ count æ‰€ä»¥appæ›´æ–°äº†ä¸‰æ¬¡ï¼Œå¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è§†è§‰æ•ˆæœä¸Šçœ‹ï¼Œé¡µé¢æ˜¯ä»0ç›´æ¥åˆ°3åˆ°ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨åŒä¸€äº‹ä»¶å¾ªç¯å†…ç›´æ¥å–countæœ€åçš„å€¼å°±å¯ä»¥äº†ï¼Œä¸å¿…è¦åšé‡å¤çš„æ¸²æŸ“ï¼Œå› æ­¤nextTickåº”è¿è€Œç”Ÿ</strong></p> <h3 id="nexttick"><a href="#nexttick" class="header-anchor">#</a> nextTick</h3> <p>åšæ³•ï¼šåœ¨æ¯æ¬¡ä¿®æ”¹countæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¸²æŸ“å‡½æ•°å­˜èµ·æ¥ï¼Œåœ¨ä¿®æ”¹ç»“æŸåå†æ‰§è¡Œæ¸²æŸ“</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> copies <span class="token operator">=</span> map<span class="token punctuation">;</span>
	map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> copies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		copies<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	map<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
		flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//ä¿®æ”¹ä¸€ä¸‹updateå‡½æ•° </span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">$nextTick</span><span class="token punctuation">(</span>render<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>ä»¥ä¸Šï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ç”¨äºå­˜å‚¨æ¸²æŸ“å‡½æ•°ï¼Œä»¥åŠ«æŒçš„å±æ€§keyä½œä¸ºå¯¹è±¡çš„key(ä¸ºäº†å»é‡)</strong></p> <p>æµ‹è¯•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">//å†æ¬¡è¾“å‡ºä¸‰æ¬¡æ¸²æŸ“</span>
<span class="token string">&quot;æ¸²æŸ“&quot;</span>
<span class="token string">&quot;æ¸²æŸ“&quot;</span>
<span class="token string">&quot;æ¸²æŸ“&quot;</span>


</code></pre></div><p>ä¾æ—§ä¸è¡Œï¼Œæˆ‘ä»¬ä¸Šé¢ è™½ç„¶æ˜¯æŠŠå‡½æ•°ä»¥keyçš„æ–¹å¼å»äº†é‡ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡ â€œå­˜â€ å’Œ â€œæ”¾â€ éƒ½åœ¨ä¸€ä¸ª ä»»åŠ¡é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šé¢çš„ä»£ç æ‰§è¡Œçš„æµç¨‹æ˜¯</p> <p>æ›´æ–°ä¸º1-&gt;renderå‡½æ•°å­˜å…¥map-&gt;mapç½®ä¸ºç©º-&gt;éå†mapå¯¹è±¡æ‰§è¡Œ
æ›´æ–°ä¸º2-&gt;renderå‡½æ•°å­˜å…¥map-&gt;mapç½®ä¸ºç©º-&gt;éå†mapå¯¹è±¡æ‰§è¡Œ
æ›´æ–°ä¸º3-&gt;renderå‡½æ•°å­˜å…¥map-&gt;mapç½®ä¸ºç©º-&gt;éå†mapå¯¹è±¡æ‰§è¡Œ</p> <p>æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼Œæ›´æ–°ä¸º1-&gt;renderå‡½æ•°å­˜å…¥mapï¼Œæ›´æ–°ä¸º2-&gt;renderå‡½æ•°å­˜å…¥mapï¼Œæ›´æ–°ä¸º3-&gt;renderå‡½æ•°å­˜å…¥mapï¼Œmapç½®ä¸ºç©º-&gt;éå†mapå¯¹è±¡æ‰§è¡Œ</p> <h4 id="å¼•å…¥å¾®ä»»åŠ¡"><a href="#å¼•å…¥å¾®ä»»åŠ¡" class="header-anchor">#</a> å¼•å…¥å¾®ä»»åŠ¡</h4> <p><strong>ä¿®æ”¹ä»£ç </strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//addä»£ç </span>
<span class="token keyword">const</span> <span class="token function-variable function">timerFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//ä¿®æ”¹ä»£ç </span>
<span class="token keyword">function</span> <span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>
		map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span>cb<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token operator">++</span><span class="token punctuation">,</span>cb<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
		flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">timerFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//æµ‹è¯•</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">//åªæœ‰ä¸€æ¬¡è¾“å‡º</span>

<span class="token string">&quot;æ¸²æŸ“&quot;</span>

</code></pre></div><p><strong>ä»¥ä¸Šï¼šæˆ‘ä»¬è¦åšçš„åŸºæœ¬å®ç°ï¼Œåœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯é‡Œæˆ‘ä»¬ä¿®æ”¹äº†ä¸‰æ¬¡æ•°æ®ï¼Œç„¶ååªæ‰§è¡Œäº†ä¸€æ¬¡æ›´æ–°ï¼Œè¾¾åˆ°äº†æˆ‘ä»¬çš„é¢„æœŸï¼Œä½†æ˜¯æˆ‘ä»¬ä¾æ—§æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
	<span class="token comment">//è¾“å‡º  0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>


</code></pre></div><p><strong>ä»¥ä¸Šï¼šæˆ‘ä»¬åªæ‹¿åˆ°äº†æ›´æ–°ä¹‹å‰çš„å€¼ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¦‚ä½•æ‹¿åˆ°æ”¹å˜åçš„å€¼å‘¢ï¼Ÿ</strong></p> <h3 id="æš´éœ²å‡ºæ¥çš„api-nexttick"><a href="#æš´éœ²å‡ºæ¥çš„api-nexttick" class="header-anchor">#</a> æš´éœ²å‡ºæ¥çš„api nextTick</h3> <p>æˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„ä»£ç ä¿®æ”¹ä¸€ä¸‹</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>
		map<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		map<span class="token punctuation">[</span>id<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
		flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">timerFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//æµ‹è¯•</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
	<span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

</code></pre></div><p>ç»“æœï¼šä¾æ—§å¤±è´¥</p> <p>åˆ†æåŸå› ï¼šå½“æˆ‘ä»¬ç”¨for inéå†mapå¯¹è±¡æ—¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬åé¢åŠ å…¥çš„å€¼å°±ä¸€å®šåœ¨åé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ¬¡ä¿®æ”¹ä¸€ä¸‹ä»£ç </p> <h4 id="nexttick2"><a href="#nexttick2" class="header-anchor">#</a> nextTick2</h4> <p>ä¿®æ”¹ä»£ç æˆ‘ä»¬æŠŠmapæ”¹ä¸ºMap</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">timerFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> copies <span class="token operator">=</span> map<span class="token punctuation">;</span>
	map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>fn<span class="token punctuation">]</span> <span class="token keyword">of</span> copies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>
		map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span>cb<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token operator">++</span><span class="token punctuation">,</span>cb<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
		flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">timerFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	
	<span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 3</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>


</code></pre></div><h3 id="æºç å†…éƒ¨çš„timerfnå‡½æ•°æœ‰æ—¶å€™æ˜¯å®ä»»åŠ¡-æœ‰æ—¶å€™æ˜¯å¾®ä»»åŠ¡"><a href="#æºç å†…éƒ¨çš„timerfnå‡½æ•°æœ‰æ—¶å€™æ˜¯å®ä»»åŠ¡-æœ‰æ—¶å€™æ˜¯å¾®ä»»åŠ¡" class="header-anchor">#</a> æºç å†…éƒ¨çš„timerFnå‡½æ•°æœ‰æ—¶å€™æ˜¯å®ä»»åŠ¡,æœ‰æ—¶å€™æ˜¯å¾®ä»»åŠ¡</h3> <p><strong>å†çœ‹ä¸€ä¸ªä¾‹å­</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn-margin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>æ›´æ”¹æ•°æ®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å‡è®¾æˆ‘ä»¬ä»£ç å¦‚ä¸‹</p> <div class="language-js extra-class"><pre class="language-js"><code>	document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#btn-margin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
		Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>ç»“æœï¼š1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¾®ä»»åŠ¡Promise.resolveæ‰§è¡Œçš„é€Ÿåº¦æ¯”å†’æ³¡è¦æ…¢ï¼Œé‚£ä¹ˆå°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œè¯·çœ‹ä¸‹é¢ç¤ºä¾‹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#btn-margin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

è¾“å‡ºä¸¤æ¬¡
<span class="token comment">//æ¸²æŸ“</span>
</code></pre></div><p><strong>ä»¥ä¸Šæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹timerFnå‡½æ•°</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">timerFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">//Promise.resolve().then(run);</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span>run<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#btn-margin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		data<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

è¾“å‡ºä¸€æ¬¡
<span class="token comment">//æ¸²æŸ“</span>
</code></pre></div><h3 id="vue-nexttickçš„å†å²"><a href="#vue-nexttickçš„å†å²" class="header-anchor">#</a> vue nextTickçš„å†å²</h3> <ul><li>2.5ä¹‹å‰å› ä¸º microtask ä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼Œäº‹ä»¶ä¼šåœ¨é¡ºåºäº‹ä»¶ï¼ˆ<a href="https://github.com/vuejs/vue/issues/4521" target="_blank" rel="noopener noreferrer">ï¼ƒ4521<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ<a href="https://github.com/vuejs/vue/issues/6690" target="_blank" rel="noopener noreferrer">ï¼ƒ6690<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æœ‰å˜é€šæ–¹æ³•ï¼‰ä¹‹é—´ç”šè‡³åœ¨åŒä¸€äº‹ä»¶çš„å†’æ³¡è¿‡ç¨‹ä¸­è§¦å‘<a href="https://github.com/vuejs/vue/issues/6566" target="_blank" rel="noopener noreferrer">ï¼ƒ6566<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</li> <li>2.5ç‰ˆæœ¬æ˜¯ macrotask ç»“åˆ microtaskã€‚ä½†æ˜¯ï¼Œåœ¨é‡ç»˜ä¹‹å‰çŠ¶æ€æ”¹å˜æ—¶ä¼šæœ‰å°é—®é¢˜ï¼ˆå¦‚<a href="https://github.com/vuejs/vue/issues/6813" target="_blank" rel="noopener noreferrer">ï¼ƒ6813<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ã€‚æ­¤å¤–ï¼Œåœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ä½¿ç”¨ macrotask ä¼šå¯¼è‡´ä¸€äº›æ— æ³•è§„é¿çš„å¥‡æ€ªè¡Œä¸ºï¼ˆ<a href="https://github.com/vuejs/vue/issues/7109" target="_blank" rel="noopener noreferrer">ï¼ƒ7109<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ<a href="https://github.com/vuejs/vue/issues/7153" target="_blank" rel="noopener noreferrer">ï¼ƒ7153<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ<a href="https://github.com/vuejs/vue/issues/7546" target="_blank" rel="noopener noreferrer">ï¼ƒ7546<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ<a href="https://github.com/vuejs/vue/issues/7834" target="_blank" rel="noopener noreferrer">ï¼ƒ7834<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ<a href="https://github.com/vuejs/vue/issues/8109" target="_blank" rel="noopener noreferrer">ï¼ƒ8109<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ã€‚</li> <li>2.6ç‰ˆæœ¬åˆæ”¹å›äº†microtaskÂ·Â·Â·Â·Â·Â·ã€‚</li></ul> <h3 id="_2-4ç‰ˆæœ¬"><a href="#_2-4ç‰ˆæœ¬" class="header-anchor">#</a> 2.4ç‰ˆæœ¬</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>panel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>expand<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>click1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Expand is True<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>expand<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>!expand<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>click2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>Expand is False<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    countA: {{countA}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    countB: {{countB}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  Please Click `Expand is Ture`.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
	  data<span class="token operator">:</span> <span class="token punctuation">{</span>
	    expand<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	    countA<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	    countB<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	  methods<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function">click1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">,</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>expand <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>countA<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">click2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">,</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>expand <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>countB<span class="token operator">++</span>
		<span class="token punctuation">}</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>


</code></pre></div><p>å…³äº<a href="https://github.com/vuejs/vue/issues/6566" target="_blank" rel="noopener noreferrer">ï¼ƒ6566<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œä»¥ä¸Šä»£ç ï¼Œå°¤é›¨æºªå›å¤ï¼š</p> <p>So, this happens because:</p> <p>The inner click event on &quot;i&quot; fires, triggering a 1st update on nextTick (microtask)
The microtask is processed before the event bubbles to the outer div. During the update, a click listener is added to the outer div.
Because the DOM structure is the same, both the outer div and the inner element are reused.
The event finally reaches outer div, triggers the listener added by the 1st update, in turn triggering a 2nd update.
This is quite tricky in fix, and other libs that leverages microtask for update queueing also have this problem (e.g. Preact). React doesn't seem to have this problem because they use a synthetic event system (probably due to edge cases like this).</p> <p>To work around it, you can simply give the two outer divs different keys to force them to be replaced during updates. This would prevent the bubbled event to be picked up:</p> <h3 id="_2-5ç‰ˆæœ¬"><a href="#_2-5ç‰ˆæœ¬" class="header-anchor">#</a> 2.5ç‰ˆæœ¬</h3> <p><strong>è¯´æ˜ï¼šé€šè¿‡æ‰“æ–­ç‚¹çš„æ–¹å¼å‘ç°ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»buttonæ—¶ï¼Œåœ¨é¡µé¢ä¸Šï¼Œcountä¸€å…±æ›´æ–°äº†ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å†’æ³¡ç»“æŸåæ‰æ‰§è¡Œçš„æ›´æ–°</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>click2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>  <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>click1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			{{count}}
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>buttton</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		el<span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
		data<span class="token operator">:</span> <span class="token punctuation">{</span>
			count<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		methods<span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token function">click1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">//debugger</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">click2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">//debugger</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-61ç‰ˆæœ¬"><a href="#_2-61ç‰ˆæœ¬" class="header-anchor">#</a> 2.61ç‰ˆæœ¬</h3> <p><strong>è¯´æ˜ï¼šå½“æˆ‘ä»¬ç‚¹å‡»buttonæ—¶ï¼Œåœ¨é¡µé¢ä¸Šï¼Œcountä¸€å…±æ›´æ–°äº†ä¸¤æ¬¡ï¼ˆå½“ç„¶ï¼Œè¿™è¯´çš„æ˜¯å½“æˆ‘ä»¬çš„æµè§ˆå™¨å†…éƒ¨æ”¯æŒPromiseï¼ŒMutationObserveræ—¶ï¼‰</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ä»£ç åŒä¸Š</p></div> <p>ä¹‹æ‰€ä»¥é‡æ–°æ”¹ä¸ºå¾®ä»»åŠ¡çš„åŸè¯ï¼š</p> <div class="language-html extra-class"><pre class="language-html"><code>// Here we have async deferring wrappers using microtasks.
// In 2.5 we used (macro) tasks (in combination with microtasks).
// However, it has subtle problems when state is changed right before repaint
// (e.g. #6813, out-in transitions).
// Also, using (macro) tasks in event handler would cause some weird behaviors
// that cannot be circumvented (e.g. #7109, #7153, #7546, #7834, #8109).
// So we now use microtasks everywhere, again.
// A major drawback of this tradeoff is that there are some scenarios
// where microtasks have too high a priority and fire in between supposedly
// sequential events (e.g. #4521, #6690, which have workarounds)
// or even between bubbling of the same event (#6566).
//è¿™é‡Œæˆ‘ä»¬æœ‰ä½¿ç”¨å¾®ä»»åŠ¡çš„å¼‚æ­¥å»¶è¿ŸåŒ…è£…å™¨ã€‚

//åœ¨2.5ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ï¼ˆå®ï¼‰ä»»åŠ¡ï¼ˆä¸å¾®ä»»åŠ¡ç›¸ç»“åˆï¼‰ã€‚

//ç„¶è€Œï¼Œå½“çŠ¶æ€åœ¨é‡æ–°ç»˜åˆ¶ä¹‹å‰è¢«æ›´æ”¹æ—¶ï¼Œå®ƒä¼šæœ‰ä¸€äº›å¾®å¦™çš„é—®é¢˜

//ï¼ˆä¾‹å¦‚#6813ï¼Œè¾“å‡ºè½¬æ¢ï¼‰ã€‚

//å¦å¤–ï¼Œåœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ä½¿ç”¨ï¼ˆå®ï¼‰ä»»åŠ¡ä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„è¡Œä¸º

//è¿™æ˜¯æ— æ³•å›é¿çš„ï¼ˆä¾‹å¦‚#7109ï¼Œ#7153ï¼Œ#7546ï¼Œ#7834ï¼Œ#8109ï¼‰ã€‚

//æ‰€ä»¥æˆ‘ä»¬ç°åœ¨åˆ°å¤„éƒ½åœ¨ä½¿ç”¨å¾®ä»»åŠ¡ã€‚

//è¿™ç§æƒè¡¡çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯å­˜åœ¨ä¸€äº›æƒ…å†µ

//å¦‚æœå¾®ä»»åŠ¡çš„ä¼˜å…ˆçº§å¤ªé«˜ï¼Œè€Œä¸”å¯èƒ½ä»‹äºä¸¤è€…ä¹‹é—´

//é¡ºåºäº‹ä»¶ï¼ˆä¾‹å¦‚#4521ï¼Œ#6690ï¼Œæœ‰è§£å†³åŠæ³•ï¼‰

//ç”šè‡³æ˜¯åœ¨åŒä¸€äº‹ä»¶çš„å†’æ³¡ä¹‹é—´ã€‚
</code></pre></div><h2 id="vue2-xä¹‹diffç®—æ³•"><a href="#vue2-xä¹‹diffç®—æ³•" class="header-anchor">#</a> vue2.xä¹‹diffç®—æ³•</h2> <h3 id="åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶æ¸²æŸ“åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸Š"><a href="#åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶æ¸²æŸ“åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸Š" class="header-anchor">#</a> åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶æ¸²æŸ“åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸Š</h3> <p>æˆ‘ä»¬ä»¥å¯¹è±¡çš„å½¢å¼è¡¨ç¤ºä¸€ä¸ªä¸ªdomå…ƒç´ ï¼Œç„¶åæ¯æ¬¡æ›´æ–°çš„æ—¶å€™é€šè¿‡å¯¹æ¯”ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¤ç”¨è€Œå¹¶éæ–°å»º</p> <p>å‡è®¾æˆ‘ä»¬çš„htmlå¦‚ä¸‹</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//ç”¨æ¥åˆ›å»ºè™šæ‹ŸdomèŠ‚ç‚¹</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token operator">...</span>children</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	children <span class="token operator">=</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> child <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span>  child
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				<span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>text<span class="token operator">:</span>child
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		tag<span class="token punctuation">,</span>
		key<span class="token punctuation">,</span>
		children
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//æŠŠè™šæ‹Ÿdomè½¬åŒ–ä¸ºçœŸæ˜¯èŠ‚ç‚¹</span>

<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> tag <span class="token punctuation">,</span>children<span class="token punctuation">,</span>text<span class="token punctuation">}</span> <span class="token operator">=</span> vnode<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
		children <span class="token operator">&amp;&amp;</span>  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆ›å»ºrenderå‡½æ•°</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span>container</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆ›å»ºä¸€ä¸ªåŒ…å«å­èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹</span>

<span class="token keyword">var</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
		
<span class="token comment">//æ‰§è¡Œæˆ‘ä»¬çš„æ¸²æŸ“å‡½æ•°</span>

<span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span>app<span class="token punctuation">)</span>

</code></pre></div><h3 id="é€šè¿‡diffç®—æ³•ä¼˜åŒ–æ›´æ–°"><a href="#é€šè¿‡diffç®—æ³•ä¼˜åŒ–æ›´æ–°" class="header-anchor">#</a> é€šè¿‡diffç®—æ³•ä¼˜åŒ–æ›´æ–°</h3> <p><strong>åˆ†æï¼šæˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡æ‹¿æ—§çš„èŠ‚ç‚¹å»æ¯”è¾ƒæ–°èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹çš„ç±»å‹å’Œkeyä¸€æ ·ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºä»–ä»¬æ˜¯ä¸€æ ·çš„å…ƒç´ ï¼Œç›´æ¥å¤ç”¨æ—§çš„èŠ‚ç‚¹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//å·¥å…·æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªdom</span>

<span class="token keyword">function</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span>newVnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> oldVnode<span class="token punctuation">.</span>tag <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>key
<span class="token punctuation">}</span>

<span class="token comment">//patchæ–¹æ³•ï¼Œæ‹¿æ–°çš„èŠ‚ç‚¹æ¯”è¾ƒæ—§çš„èŠ‚ç‚¹</span>

<span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span>newVnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//å‡è®¾ä¸¤ä¸ªå…ƒç´ çš„èŠ‚ç‚¹ç±»å‹ä¸åŒï¼Œç›´æ¥æ‹¿æ–°èŠ‚ç‚¹æ›¿æ¢è€èŠ‚ç‚¹ </span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>newVnode<span class="token punctuation">.</span>tag <span class="token operator">!==</span> oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
		oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span>oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> el<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//å‡è®¾ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯æ–‡å­—èŠ‚ç‚¹ ï¼Œå¦‚æœèŠ‚ç‚¹ä¸ä¸€æ ·ï¼Œç›´æ¥æ‹¿æ–°çš„æ–‡å­—æ›¿æ¢è€çš„æ–‡å­— </span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> newVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>text
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// å‡è®¾ä¸¤ä¸ªèŠ‚ç‚¹ç±»å‹ç›¸åŒï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ—§èŠ‚ç‚¹èµ‹ç»™æ–°èŠ‚ç‚¹</span>
	<span class="token keyword">let</span> el <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldChildren <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newChildren <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">// å­å…ƒç´ å¯¹æ¯”</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> newChildren<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//å¦‚æœæ–°æ—§èŠ‚ç‚¹éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å»å¯¹æ¯”å­èŠ‚ç‚¹</span>
		<span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span>oldChildren<span class="token punctuation">,</span>newChildren<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//å¦‚æœæ–°èŠ‚ç‚¹ æœ‰å­å…ƒç´ ï¼Œè€Œæ—§èŠ‚ç‚¹æ²¡æœ‰ï¼Œæˆ‘ä»¬ ç›´æ¥æŠŠæ–°çš„å­èŠ‚ç‚¹æ”¾å…¥çˆ¶å…ƒç´ ä¸­</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> child <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldChildren<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//å‡è®¾è€èŠ‚ç‚¹ æœ‰å­å…ƒç´ ï¼Œè€Œæ–°èŠ‚ç‚¹æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æŠŠå…ƒç´ çš„å†…å®¹æ¸…ç©ºå³å¯</span>
		el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>ä»¥ä¸Šï¼šæ›´æ–°å­èŠ‚ç‚¹æ—¶ï¼Œåé¢ä¸¤ç§æƒ…å†µéƒ½å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨æ–°æ—§èŠ‚ç‚¹éƒ½æœ‰çš„æƒ…å†µä¸‹æ—¶å¦‚ä½•åšå¯¹æ¯”çš„ã€‚è¯·çœ‹ä¸‹é¢ä»£ç </strong></p> <h3 id="å¯¹æ¯”æ›´æ–°å­èŠ‚ç‚¹"><a href="#å¯¹æ¯”æ›´æ–°å­èŠ‚ç‚¹" class="header-anchor">#</a> å¯¹æ¯”æ›´æ–°å­èŠ‚ç‚¹</h3> <h4 id="ä¼˜åŒ–å±‚é¢çš„å¯¹æ¯”"><a href="#ä¼˜åŒ–å±‚é¢çš„å¯¹æ¯”" class="header-anchor">#</a> ä¼˜åŒ–å±‚é¢çš„å¯¹æ¯”</h4> <p><strong>è¯´æ˜ï¼šæˆ‘ä»¬åœ¨æ“ä½œdomæ—¶ï¼Œä¸€èˆ¬ä¼šæœ‰å‡ ç§æ“ä½œ</strong></p> <h4 id="_1ï¼Œå°¾éƒ¨æ’å…¥å…ƒç´ ã€‚"><a href="#_1ï¼Œå°¾éƒ¨æ’å…¥å…ƒç´ ã€‚" class="header-anchor">#</a> 1ï¼Œå°¾éƒ¨æ’å…¥å…ƒç´ ã€‚</h4> <p>ä¾‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//è€èŠ‚ç‚¹</span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d
<span class="token comment">//æ–°èŠ‚ç‚¹</span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>e

<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//åŒæŒ‡é’ˆå¯¹æ¯” </span>
	<span class="token keyword">let</span> oldStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldEndIndex <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
	
	<span class="token keyword">let</span> newStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newEndIndex <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span>oldStartIndex<span class="token operator">&lt;=</span>oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//å‡è®¾æ–°èŠ‚ç‚¹çš„é¦–ä¸ªå…ƒç´ å’Œæ—§èŠ‚ç‚¹çš„é¦–ä¸ªå…ƒç´ ç›¸åŒï¼Œé‚£æˆ‘ä»¬ç›´æ¥æŠŠå¤ç”¨è€èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ–°æ—§èŠ‚ç‚¹çš„å¤´éƒ¨æŒ‡é’ˆéƒ½å‘åç§»ä½</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">patch</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
			oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//æ­¤æ—¶æ–°èŠ‚ç‚¹çš„å¤´éƒ¨æŒ‡é’ˆå’Œæ–°èŠ‚ç‚¹çš„å°¾éƒ¨æŒ‡é’ˆé‡åˆ</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>newStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> el <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">;</span>
			<span class="token comment">//æ­¤æ—¶elä¸ºnull,å› æ­¤ä¸‹æ–¹çš„æ“ä½œ ç­‰åŒäº parentElm.appendChild(createElement(newCh[i]))</span>
			parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>el<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2ï¼Œå¾€å¤´éƒ¨æ’å…¥å…ƒç´ ã€‚"><a href="#_2ï¼Œå¾€å¤´éƒ¨æ’å…¥å…ƒç´ ã€‚" class="header-anchor">#</a> 2ï¼Œå¾€å¤´éƒ¨æ’å…¥å…ƒç´ ã€‚</h4> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//è€èŠ‚ç‚¹</span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d
<span class="token comment">//æ–°èŠ‚ç‚¹</span>
e<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d

<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//åŒæŒ‡é’ˆå¯¹æ¯” </span>
	<span class="token comment">//åŒä¸Š</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span>oldStartIndex<span class="token operator">&lt;=</span>oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token comment">//å‡è®¾æ–°èŠ‚ç‚¹çš„æœ«å°¾å…ƒç´ å’Œæ—§èŠ‚ç‚¹çš„æœ«å°¾å…ƒç´ ç›¸åŒï¼Œæˆ‘ä»¬ä¾æ—§ç›´æ¥æŠŠå¤ç”¨è€èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ–°æ—§èŠ‚ç‚¹çš„å°¾éƒ¨æŒ‡é’ˆéƒ½å‰ç§»</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">patch</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//å°¾æŒ‡é’ˆå‰ç§»</span>
			oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//æ­¤æ—¶æ–°èŠ‚ç‚¹çš„å¤´éƒ¨æŒ‡é’ˆå’Œæ–°èŠ‚ç‚¹çš„å°¾éƒ¨æŒ‡é’ˆé‡åˆä¸º0</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>newStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">//æ­¤æ—¶newCh[newEndIndex+1]æŒ‡å‘æ–°èŠ‚ç‚¹a</span>
			<span class="token keyword">let</span> el <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">;</span>
			<span class="token comment">//æ­¤æ—¶elä¸ºaï¼ŒèŠ‚ç‚¹açš„elå¤ç”¨äº†æ—§èŠ‚ç‚¹çš„el</span>
			<span class="token comment">//å› æ­¤æˆ‘ä»¬ç›´æ¥åˆ›å»ºèŠ‚ç‚¹eçš„çœŸå®èŠ‚ç‚¹ å¹¶ç›´æ¥æ’å…¥åœ¨èŠ‚ç‚¹aå‰</span>
			parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>el<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><h4 id="_3ï¼Œäº¤å‰å¯¹æ¯”"><a href="#_3ï¼Œäº¤å‰å¯¹æ¯”" class="header-anchor">#</a> 3ï¼Œäº¤å‰å¯¹æ¯”</h4> <p><strong>å°¾ç§»å¤´æˆ–è€…å¤´ç§»å°¾</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//1ï¼Œå¤´ç§»å°¾</span>
<span class="token comment">//è€èŠ‚ç‚¹ </span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d
æ–°èŠ‚ç‚¹
b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a

æˆ–è€…

<span class="token comment">//2.å°¾ç§»å¤´</span>
<span class="token comment">//è€èŠ‚ç‚¹ </span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d
æ–°èŠ‚ç‚¹
d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>

å†æˆ–è€…

<span class="token comment">//3.åè½¬</span>
 <span class="token comment">//è€èŠ‚ç‚¹ </span>
 a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d
 æ–°èŠ‚ç‚¹
 d<span class="token punctuation">,</span>c<span class="token punctuation">,</span>b<span class="token punctuation">,</span>a

<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">/*
			...
			*/</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span>oldStartIndex<span class="token operator">&lt;=</span>oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
			
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">/*
				...
				*/</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">/*
				...
				*/</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">//å¤´ç§»å°¾</span>
				<span class="token comment">//a,b,c,d =&gt; b,c,d,a</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span>
				<span class="token comment">//æŠŠå¤´éƒ¨å…ƒç´ æ·»åŠ åˆ°å°¾éƒ¨å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span>
				<span class="token comment">//æ—§èŠ‚ç‚¹å¤´éƒ¨æŒ‡é’ˆå‘åç§»</span>
				oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token comment">//æ–°èŠ‚ç‚¹å°¾éƒ¨æŒ‡é’ˆå‘å‰ç§»</span>
				newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">//å°¾ç§»å¤´</span>
				<span class="token comment">//a,b,c,d =&gt; d,a,b,c</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
				<span class="token comment">//æŠŠå°¾éƒ¨å…ƒç´ ç§»åŠ¨åˆ°å¤´éƒ¨å…ƒç´ ä¹‹å‰</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
				<span class="token comment">//æ—§èŠ‚ç‚¹å°¾æŒ‡é’ˆå‘å‰ç§»</span>
				oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token comment">//æ–°èŠ‚ç‚¹å¤´éƒ¨æŒ‡é’ˆå‘åç§»</span>
				newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>newStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> el <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">;</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>el<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>



</code></pre></div><p><strong>ä»¥ä¸Šå…¶å®éƒ½æ˜¯ä¸€äº›ä¼˜åŒ–ç­–ç•¥ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¹±åºå‘¢ï¼Ÿ</strong></p> <h4 id="ä¹±åº"><a href="#ä¹±åº" class="header-anchor">#</a> ä¹±åº</h4> <p>è€èŠ‚ç‚¹a,b,c,d</p> <p>æ–°èŠ‚ç‚¹e,a,f,c,g</p> <p><strong>å¤´å’Œå¤´ä¸åŒï¼Œå°¾å’Œå°¾ä¸åŒï¼Œå¤´å’Œå°¾ï¼Œå°¾å’Œå¤´ï¼Œéƒ½ä¸åŒï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æŠŠæ—§èŠ‚ç‚¹ç”¨keyç”Ÿæˆä¸€ä¸ªæ˜ å°„è¡¨ï¼Œç„¶åæ¯æ¬¡åœ¨è¡¨é‡Œå»æ‰¾æ–°èŠ‚ç‚¹ï¼Œè¯·çœ‹æœ€åä¸€ç§æƒ…å†µ</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> oldStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldEndIndex <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
	
	<span class="token keyword">let</span> newStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newEndIndex <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
	
	<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token function">createIndexByKey</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span>oldStartIndex<span class="token operator">&lt;=</span>oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">{</span>
			oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">{</span>
			oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">patch</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
			oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">patch</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span>
			oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">patch</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span>
			parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span>
			oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">patch</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
			parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
			oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token comment">//ä¹±åº</span>
			<span class="token comment">//ç”¨æ—§çš„èŠ‚ç‚¹çš„keyç”Ÿæˆä¸€ä¸ªæ˜ å°„è¡¨ï¼Œé‚£æ–°çš„èŠ‚ç‚¹çš„keyå†æ˜ å°„è¡¨é‡Œé¢å¯»æ‰¾ï¼Œæ‰¾åˆ°å°±åšç§»åŠ¨æ“ä½œï¼Œæ‰¾ä¸åˆ°å°±ç›´æ¥æ’å…¥å³å¯</span>
			<span class="token comment">//debugger</span>
			<span class="token keyword">let</span>  findedIndex <span class="token operator">=</span> map<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>findedIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> findVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>findedIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token comment">//é˜²æ­¢æ•°ç»„å¡Œé™·ï¼Œæ­¤å¤„ç½®ä¸ºç©º</span>
				oldCh<span class="token punctuation">[</span>findedIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
				<span class="token comment">//å½“æ—§èŠ‚ç‚¹é‡æœ‰è¿™ä¸ªkeyæ—¶ï¼Œç›´æ¥æŠŠæ‰¾åˆ°çš„è¿™ä¸ªèŠ‚ç‚¹å…ƒç´ ç§»åŠ¨åˆ°å¼€å§‹èŠ‚ç‚¹çš„å‰é¢</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>findVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>findVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token comment">//å¦‚æœæ‰¾ä¸åˆ°ï¼Œç›´æ¥åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œç§»åŠ¨æ—§çš„å¼€å§‹èŠ‚ç‚¹å‰</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
				
			<span class="token punctuation">}</span>
			<span class="token comment">//æ–°èŠ‚ç‚¹å¤´æŒ‡é’ˆå‘åç§»åŠ¨</span>
			newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>newStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> el <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">;</span>
			parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>el<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>oldStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>oldEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> child <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">{</span>
				parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="header-anchor">#</a> å®Œæ•´ä»£ç </h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">createIndexByKey</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>
				map<span class="token punctuation">[</span>item<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> index
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> map<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span>newVnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> oldVnode<span class="token punctuation">.</span>tag <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>key
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span>newVnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>newVnode<span class="token punctuation">.</span>tag <span class="token operator">!==</span> oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
			oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span>oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> el<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> newVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>text
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">let</span> el <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
		<span class="token keyword">let</span> oldChildren <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> newChildren <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> newChildren<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span>oldChildren<span class="token punctuation">,</span>newChildren<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">let</span> child <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldChildren<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> el<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> oldStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> oldEndIndex <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		
		<span class="token keyword">let</span> newStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> newEndIndex <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
		
		<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token function">createIndexByKey</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span>
		
		<span class="token keyword">while</span><span class="token punctuation">(</span>oldStartIndex<span class="token operator">&lt;=</span>oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
			
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">{</span>
				oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">{</span>
				oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
				oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span>
				oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span>newEndVnode<span class="token punctuation">)</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span>
				oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">patch</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
				oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token comment">//ä¹±åº</span>
				<span class="token comment">//ç”¨æ—§çš„èŠ‚ç‚¹çš„keyç”Ÿæˆä¸€ä¸ªæ˜ å°„è¡¨ï¼Œé‚£æ–°çš„èŠ‚ç‚¹çš„keyå†æ˜ å°„è¡¨é‡Œé¢å¯»æ‰¾ï¼Œæ‰¾åˆ°å°±åšç§»åŠ¨æ“ä½œï¼Œæ‰¾ä¸åˆ°å°±ç›´æ¥æ’å…¥å³å¯</span>
				<span class="token comment">//debugger</span>
				<span class="token keyword">let</span>  findedIndex <span class="token operator">=</span> map<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>findedIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">let</span> findVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>findedIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
					oldCh<span class="token punctuation">[</span>findedIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
					parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>findVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
					<span class="token function">patch</span><span class="token punctuation">(</span>findVnode<span class="token punctuation">,</span>newStartVnode<span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">,</span>oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span>
				newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>newStartIndex<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>newStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>newEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> el <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">;</span>
				parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>el<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>oldStartIndex<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>oldEndIndex<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> child <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">{</span>
					parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token operator">...</span>children</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		children <span class="token operator">=</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> child <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span>  child
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token punctuation">{</span>
					<span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>text<span class="token operator">:</span>child
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			tag<span class="token punctuation">,</span>
			key<span class="token punctuation">,</span>
			children
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span>  app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> tag <span class="token punctuation">,</span>children<span class="token punctuation">,</span>text<span class="token punctuation">}</span> <span class="token operator">=</span> vnode<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
			children <span class="token operator">&amp;&amp;</span>  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">return</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span>container</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
		container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span>app<span class="token punctuation">)</span>
	<span class="token keyword">var</span> newVnode <span class="token operator">=</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token function">patch</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span>newVnode<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>


</code></pre></div><p><strong>å½“ç„¶ï¼ŒçœŸå®çš„æƒ…å†µè‚¯å®šæ˜¯æ›´åŠ çš„å¤æ‚ï¼Œæ¯”å¦‚è¯´åŒä¸€ä¸ªèŠ‚ç‚¹ç›¸åŒçš„keyï¼Œæˆ‘ä»¬åœ¨patchä¸­è‚¯å®šè¿˜æ˜¯è¦æ›´æ–°æ–°æ—§props  style  attrç­‰ï¼Œç„¶è€Œè¿™äº›å¹¶ä¸æ˜¯æœ¬èŠ‚çš„é‡ç‚¹</strong></p> <h3 id="å…³äºkey"><a href="#å…³äºkey" class="header-anchor">#</a> å…³äºkey</h3> <h4 id="å¸¦æœ‰keyçš„ä¼˜åŒ–"><a href="#å¸¦æœ‰keyçš„ä¼˜åŒ–" class="header-anchor">#</a> å¸¦æœ‰keyçš„ä¼˜åŒ–</h4> <p><strong>å‡å¦‚æ–°æ—§èŠ‚ç‚¹å¦‚ä¸‹</strong></p> <div class="language-html extra-class"><pre class="language-html"><code>æ—§èŠ‚ç‚¹
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>d<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
æ–°èŠ‚ç‚¹

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>d<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>å¦‚ä»¥ä¸Šå¸¦æœ‰keyï¼Œæˆ‘ä»¬åœ¨æ¯”å¯¹çš„æ—¶å€™ï¼Œç›´æ¥ç§»åŠ¨å¤ç”¨å°±å¥½äº†</p> <p><strong>å‡è®¾æ²¡æœ‰key</strong></p> <div class="language-html extra-class"><pre class="language-html"><code>æ—§èŠ‚ç‚¹
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
æ–°èŠ‚ç‚¹

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>å¦‚ä¸Šï¼Œæ²¡æœ‰keyï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ›´æ–°å››æ¬¡ï¼Œå³ä¾æ¬¡æ›´æ”¹æ¯ä¸€ä¸ªlié‡Œé¢çš„å†…å®¹</p> <h3 id="ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸å»ºè®®ç”¨indexä½œä¸ºkey"><a href="#ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸å»ºè®®ç”¨indexä½œä¸ºkey" class="header-anchor">#</a> ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸å»ºè®®ç”¨indexä½œä¸ºkey</h3> <div class="language-html extra-class"><pre class="language-html"><code>å‡è®¾æ•°æ®å¦‚ä¸‹

list = [a,b,c,d]

å¾ªç¯ååœ¨htmlé‡Œ

æ—§èŠ‚ç‚¹
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

æ–°èŠ‚ç‚¹
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p><strong>å¦‚ä¸Šï¼šæˆ‘ä»¬åœ¨å¯¹æ¯”æ—¶æœ¬æ¥å¯ä»¥ç›´æ¥ç§»åŠ¨å¤ç”¨çš„ï¼Œä½†æ˜¯æ­¤æ—¶ï¼Œæ ¹æ®ä¸Šé¢å¯¹æ¯”ï¼Œä¼šå¾—åˆ°é¦–ä½å…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œç„¶åä¾æ¬¡æ›´æ–°å…¶å†…å®¹åŠå…¶å®ƒï¼Œè¿™å®Œå…¨æ˜¯ä¸å¿…è¦çš„</strong></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/atJiangBei/blog/edit/master/docs/vue/vue2/README.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2020-8-21 18:39:33</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.71c01b6c.js" defer></script><script src="/blog/assets/js/2.c0191e23.js" defer></script><script src="/blog/assets/js/31.a00248a5.js" defer></script><script src="/blog/assets/js/3.d0de4903.js" defer></script>
  </body>
</html>
